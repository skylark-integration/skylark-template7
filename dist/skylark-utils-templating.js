/**
 * skylark-utils-templating - The skylark template engine library.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.1
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(e,t){function r(e,t){if("."!==e[0])return e;var r=t.split("/"),n=e.split("/");r.pop();for(var i=0;i<n.length;i++)"."!=n[i]&&(".."==n[i]?r.pop():r.push(n[i]));return r.join("/")}var n=t.define,i=t.require,a="function"==typeof n&&n.amd,l=!a&&"undefined"!=typeof exports;if(!a&&!n){var s={};n=t.define=function(e,t,n){"function"==typeof n?(s[e]={factory:n,deps:t.map(function(t){return r(t,e)}),exports:null},i(e)):s[e]=n},i=t.require=function(e){if(!s.hasOwnProperty(e))throw new Error("Module "+e+" has not been defined");var t=s[e];if(!t.exports){var r=[];t.deps.forEach(function(e){r.push(i(e))}),t.exports=t.factory.apply(window,r)}return t.exports}}if(!n)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(e(n,i),!a){var p=i("skylark-langx/skylark");l?exports=p:t.skylarkjs=p}}(function(e,r){e("skylark-utils-templating/templating",["skylark-langx/skylark"],function(e){return e.templating={helpers:{}}}),e("skylark-utils-templating/helpers/each",["skylark-langx/types","../templating"],function(e,t){return t.helpers.each=function(t,r){var n="",i=0;if(e.isFunction(t)&&(t=t.call(this)),e.isArray(t)){for(r.hash.reverse&&(t=t.reverse()),i=0;i<t.length;i++)t[i].templater=this.templater,n+=r.fn(t[i],{first:0===i,last:i===t.length-1,index:i});r.hash.reverse&&(t=t.reverse())}else for(var a in t)i++,t[a].templater=this.templater,n+=r.fn(t[a],{key:a});return i>0?n:r.inverse(this)}}),e("skylark-utils-templating/helpers/if",["skylark-langx/types","../templating"],function(e,t){return t.helpers["if"]=function(t,r){return e.isFunction(t)&&(t=t.call(this)),t?r.fn(this,r.data):r.inverse(this,r.data)}}),e("skylark-utils-templating/helpers/join",["skylark-langx/types","../templating"],function(e,t){return t.helpers.join=function(t,r){return e.isFunction(t)&&(t=t.call(this)),t.join(r.hash.delimiter)}}),e("skylark-utils-templating/helpers/js",["skylark-langx/types","../templating"],function(e,t){return t.helpers.js=function(e,t){var r;return r=e.indexOf("return")>=0?"(function(){"+e+"})":"(function(){return ("+e+")})",eval.call(this,r).call(this)}}),e("skylark-utils-templating/helpers/js_compare",["skylark-langx/types","../templating"],function(e,t){return t.helpers.js_compare=function(e,t){var r;r=e.indexOf("return")>=0?"(function(){"+e+"})":"(function(){return ("+e+")})";var n=eval.call(this,r).call(this);return n?t.fn(this,t.data):t.inverse(this,t.data)}}),e("skylark-utils-templating/helpers/partial",["skylark-langx/types","../templating"],function(e,t){return t.helpers.partial=function(e,t){const r=this,n=this.templater._partials[e];return!n||n&&!n.template?"":(n.compiled||(n.compiled=this.templater.compile(n.template)),Object.keys(t.hash).forEach(function(e){r[e]=t.hash[e]}),n.compiled(r,t.data,t.root))}}),e("skylark-utils-templating/helpers/unless",["skylark-langx/types","../templating"],function(e,t){return t.helpers.unless=function(t,r){return e.isFunction(t)&&(t=t.call(this)),t?r.inverse(this,r.data):r.fn(this,r.data)}}),e("skylark-utils-templating/helpers/with",["skylark-langx/types","../templating"],function(e,t){return t.helpers["with"]=function(t,r){return e.isFunction(t)&&(t=t.call(this)),r.fn(t)}}),e("skylark-utils-templating/Templater",["skylark-langx/types","skylark-langx/objects","skylark-langx/Evented","./templating","./helpers/each","./helpers/if","./helpers/join","./helpers/js","./helpers/js_compare","./helpers/partial","./helpers/unless","./helpers/with"],function(e,r,n,i,a,l,s,p,o,f,u,h){"use strict";function c(e){var t,r,n,i=e.replace(/[{}#}]/g,"").split(" "),a=[];for(r=0;r<i.length;r++){var l=i[r];if(0===r)a.push(l);else if(0===l.indexOf('"'))if(2===l.match(/"/g).length)a.push(l);else{for(t=0,n=r+1;n<i.length;n++)if(l+=" "+i[n],i[n].indexOf('"')>=0){t=n,a.push(l);break}t&&(r=t)}else if(l.indexOf("=")>0){var s=l.split("="),p=s[0],o=s[1];if(2!==o.match(/"/g).length){for(t=0,n=r+1;n<i.length;n++)if(o+=" "+i[n],i[n].indexOf('"')>=0){t=n;break}t&&(r=t)}var f=[p,o.replace(/"/g,"")];a.push(f)}else a.push(l)}return a}function g(t){var r,n,i=[];if(!t)return[];var a=t.split(/({{[^{^}]*}})/);for(r=0;r<a.length;r++){var l=a[r];if(""!==l)if(l.indexOf("{{")<0)i.push({type:"plain",content:l});else{if(l.indexOf("{/")>=0)continue;if(l.indexOf("{#")<0&&l.indexOf(" ")<0&&l.indexOf("else")<0){i.push({type:"variable",contextName:l.replace(/[{}]/g,"")});continue}var s=c(l),p=s[0],o=">"===p,f=[],u={};for(n=1;n<s.length;n++){var h=s[n];e.isArray(h)?u[h[0]]="false"!==h[1]&&h[1]:f.push(h)}if(l.indexOf("{#")>=0){var g,m="",d="",y=0,k=!1,v=!1,x=0;for(n=r+1;n<a.length;n++)if(a[n].indexOf("{{#")>=0&&x++,a[n].indexOf("{{/")>=0&&x--,a[n].indexOf("{{#"+p)>=0)m+=a[n],v&&(d+=a[n]),y++;else if(a[n].indexOf("{{/"+p)>=0){if(!(y>0)){g=n,k=!0;break}y--,m+=a[n],v&&(d+=a[n])}else a[n].indexOf("else")>=0&&0===x?v=!0:(v||(m+=a[n]),v&&(d+=a[n]));k&&(g&&(r=g),i.push({type:"helper",helperName:p,contextName:f,content:m,inverseContent:d,hash:u}))}else l.indexOf(" ")>0&&(o&&(p="partial",f[0]&&(0===f[0].indexOf("[")?f[0]=f[0].replace(/[[\]]/g,""):f[0]=f[0].replace(/"|'/g,""))),i.push({type:"helper",helperName:p,contextName:f,hash:u}))}}return i}var m=n.inherit({klassName:"Templater",init:function(e,t){this._options=e||{},this._helpers=r.mixin({each:a,"if":l,join:s,js:p,js_compare:o,partial:f,unless:u,"with":h},t),this._partials={},this._cache={}},compile:function(e){function r(e,t){return e.content?l(e.content,t):function(){return""}}function n(e,t){return e.inverseContent?l(e.inverseContent,t):function(){return""}}function i(e,t){var r,n,i=0;if(0===e.indexOf("../")){i=e.split("../").length-1;var a=t.split("_")[1]-i;t="ctx_"+(a>=1?a:1),n=e.split("../")[i].split(".")}else 0===e.indexOf("@global")?(t="$.Template7.global",n=e.split("@global.")[1].split(".")):0===e.indexOf("@root")?(t="ctx_1",n=e.split("@root.")[1].split(".")):n=e.split(".");r=t;for(var l=0;l<n.length;l++){var s=n[l];0===s.indexOf("@")?l>0?r+="[(data && data."+s.replace("@","")+")]":r="(data && data."+e.replace("@","")+")":isFinite(s)?r+="["+s+"]":0===s.indexOf("this")?r=s.replace("this",t):r+="."+s}return r}function a(e,t){for(var r=[],n=0;n<e.length;n++)0===e[n].indexOf('"')?r.push(e[n]):r.push(i(e[n],t));return r.join(", ")}function l(e,l){if(l=l||1,e=e||t.template,"string"!=typeof e)throw new Error("Template7: Template must be a string");var p=g(e);if(0===p.length)return function(){return""};var o="ctx_"+l,f="(function ("+o+", data) {\n";1===l&&(f+=o+".templater = this\n",f+="function isArray(arr){return Object.prototype.toString.apply(arr) === '[object Array]';}\n",f+="function isFunction(func){return (typeof func === 'function');}\n",f+='function c(val, ctx) {if (typeof val !== "undefined") {if (isFunction(val)) {return val.call(ctx);} else return val;} else return "";}\n'),f+="var r = '';\n";var u;for(u=0;u<p.length;u++){var h=p[u];if("plain"!==h.type){var c,m;if("variable"===h.type&&(c=i(h.contextName,o),f+="r += c("+c+", "+o+");"),"helper"===h.type)if(h.helperName in s._helpers)m=a(h.contextName,o),f+="r += "+o+".templater._helpers."+h.helperName+".call("+o+", "+(m&&m+", ")+"{hash:"+JSON.stringify(h.hash)+", data: data || {}, fn: "+r(h,l+1)+", inverse: "+n(h,l+1)+", root: ctx_1});";else{if(h.contextName.length>0)throw new Error('Missing helper: "'+h.helperName+'"');c=i(h.helperName,o),f+="if ("+c+") {",f+="if (isArray("+c+")) {",f+="r += "+o+".templater._helpers.each.call("+o+", "+c+", {hash:"+JSON.stringify(h.hash)+", data: data || {}, fn: "+r(h,l+1)+", inverse: "+n(h,l+1)+", root: ctx_1});",f+="}else {",f+="r += "+o+".templater._helpers.with.call("+o+", "+c+", {hash:"+JSON.stringify(h.hash)+", data: data || {}, fn: "+r(h,l+1)+", inverse: "+n(h,l+1)+", root: ctx_1});",f+="}}"}}else f+="r +='"+h.content.replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/'/g,"\\'")+"';"}return f+="\nreturn r;})",eval.call(window,f)}var s=this,p=this._cache[e];if(!p){var o=l(e);p=this._cache[e]=function(){return o.apply(s,arguments)}}return p},render:function(e,t){var r=this.compile(e);return r(t)},registerHelper:function(e,t){this._helpers[e]=t},unregisterHelper:function(e){this._helpers[e]=void 0,delete this._helpers[e]},registerPartial:function(e,t){this._partials[e]={template:t}},unregisterPartial:function(e){this._partials[e]&&(this._partials[e]=void 0,delete this._partials[e])}}),d=m.defaultTemplater=new m;return["registerHelper","registerPartial","unregisterHelper","unregisterPartial","render","compile"].forEach(function(e){i[e]=function(){return m.prototype[e].apply(d,arguments)}}),i.Templater=m}),e("skylark-utils-templating/main",["./templating","./Templater"],function(e){return e}),e("skylark-utils-templating",["skylark-utils-templating/main"],function(e){return e})},this);
//# sourceMappingURL=sourcemaps/skylark-utils-templating.js.map
